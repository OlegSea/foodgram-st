# Foodgram - «Продуктовый помощник»

[![Python](https://img.shields.io/badge/Python-3.11-blue)](https://www.python.org/)
[![Django](https://img.shields.io/badge/Django-5.2.8-green)](https://www.djangoproject.com/)
[![DRF](https://img.shields.io/badge/DRF-3.16.1-red)](https://www.django-rest-framework.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13-blue)](https://www.postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-latest-blue)](https://www.docker.com/)
[![Nginx](https://img.shields.io/badge/Nginx-latest-green)](https://nginx.org/)

## Описание проекта

Foodgram — веб-приложение для публикации рецептов, подписок на авторов и создания списков покупок. Пользователи могут делиться своими рецептами, добавлять понравившиеся в избранное и формировать список покупок для выбранных блюд.

## Основные возможности

### Для всех пользователей
- Просмотр рецептов на главной странице с пагинацией
- Просмотр страниц отдельных рецептов
- Просмотр страниц пользователей
- Регистрация аккаунта
- Фильтрация рецептов по тегам

### Для авторизованных пользователей
- Вход и выход из системы
- Смена пароля и аватара
- Создание, редактирование и удаление собственных рецептов
- Добавление рецептов в избранное и удаление из него
- Добавление рецептов в список покупок
- Скачивание списка покупок в виде файла
- Подписка на авторов рецептов и отписка от них
- Просмотр страниц: "Избранное", "Список покупок", "Мои подписки"

### Для администраторов
- Все права авторизованного пользователя
- Доступ к админ-панели Django
- Создание, блокировка и удаление пользователей
- Редактирование и удаление любых рецептов
- Управление тегами и ингредиентами

## Технологический стек

### Backend
- **Python 3.11**
- **Django 5.2.8** — веб-фреймворк
- **Django REST Framework 3.16.1** — для создания API
- **Djoser 2.3.3** — аутентификация через токены
- **PostgreSQL** — основная база данных
- **Pillow 12.0.0** — работа с изображениями

### Frontend
- **React** — SPA-приложение
- **JavaScript/HTML/CSS**

### DevOps
- **Docker & Docker Compose** — контейнеризация
- **Nginx** — веб-сервер и прокси
- **GitHub Actions** — CI/CD

## Архитектура проекта

```
foodgram-st/
├── backend/                 # Django-приложение
│   ├── api/                # API эндпоинты
│   ├── foodgram/          # Настройки проекта
│   ├── recipes/           # Модели рецептов и ингредиентов
│   ├── users/             # Модели пользователей
│   ├── requirements.txt   # Python зависимости
│   └── Dockerfile        # Образ backend
├── frontend/              # React-приложение
├── infra/                # Инфраструктура
│   ├── docker-compose.yml
│   └── nginx.conf
├── data/                 # Данные для загрузки
└── docs/                # Документация API
```

## Модели данных

### Основные модели
- **User** — пользователи (расширенная модель Django)
- **Recipe** — рецепты
- **Ingredient** — ингредиенты
- **Tag** — теги для рецептов
- **RecipeIngredient** — связь рецептов и ингредиентов с количеством
- **Favorite** — избранные рецепты пользователей
- **ShoppingCart** — список покупок пользователей
- **Follow** — подписки пользователей

## Установка и запуск

### Предварительные требования
- Docker и Docker Compose
- Git
- Just (опционально, но рекомендуется для упрощения команд)

### Установка Just (рекомендуется)
```bash
# macOS
brew install just

# Ubuntu/Debian
sudo apt install just

# Arch Linux
sudo pacman -S just

# Или через Cargo
cargo install just
```

### Клонирование репозитория
```bash
git clone https://github.com/your-username/foodgram-st.git
cd foodgram-st
```

### Быстрый запуск с Just (рекомендуется)

#### 1. Подготовка окружения
Создайте файл `.env` в директории `infra/` на основе `env.example`:

```bash
cp infra/env.example infra/.env
```

Заполните переменные окружения:
```env
# Django
SECRET_KEY=your-secret-key-here
DEBUG=False
ALLOWED_HOSTS=localhost,127.0.0.1,your-domain.com

# Database
POSTGRES_DB=foodgram
POSTGRES_USER=foodgram_user
POSTGRES_PASSWORD=foodgram_password
DB_HOST=db
DB_PORT=5432

# Other
USE_POSTGRESQL=True
```

#### 2. Запуск проекта
```bash
# Для локальной разработки (сборка из исходников)
just build

# Или для продакшена (готовые образы)
just run
```

#### 3. Остановка проекта
```bash
just down
```

**Готово!** Приложение будет доступно по адресу: http://localhost:3000

> **Примечание**: При запуске автоматически выполняются:
> - Применение миграций
> - Загрузка данных об ингредиентов
> - Сборка статических файлов
> - Создание суперпользователя (admin/admin@example.com/admin)

### Альтернативный запуск без Just

#### Сборка и запуск контейнеров
```bash
cd infra/

# Для локальной разработки
docker-compose -f docker-compose.local.yml up --build

# Для продакшена
docker-compose up -d
```

#### Остановка
```bash
cd infra/
docker-compose down
```

Приложение будет доступно по адресу: http://localhost:3000

### Локальная разработка

#### 1. Настройка Python окружения
```bash
cd backend/
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
pip install -r requirements.txt
```

#### 2. Настройка базы данных
```bash
# Применение миграций
python manage.py migrate

# Загрузка тестовых данных
python manage.py loaddata fixtures/ingredients.json

# Создание суперпользователя
python manage.py createsuperuser
```

#### 3. Запуск сервера разработки
```bash
python manage.py runserver
```

## API Документация

### Основные эндпоинты

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/api/recipes/` | Список рецептов |
| POST | `/api/recipes/` | Создание рецепта |
| GET | `/api/recipes/{id}/` | Получение рецепта |
| PATCH | `/api/recipes/{id}/` | Обновление рецепта |
| DELETE | `/api/recipes/{id}/` | Удаление рецепта |
| GET | `/api/recipes/download_shopping_cart/` | Скачать список покупок |
| POST | `/api/recipes/{id}/shopping_cart/` | Добавить в список покупок |
| DELETE | `/api/recipes/{id}/shopping_cart/` | Удалить из списка покупок |
| POST | `/api/recipes/{id}/favorite/` | Добавить в избранное |
| DELETE | `/api/recipes/{id}/favorite/` | Удалить из избранного |
| GET | `/api/users/` | Список пользователей |
| POST | `/api/users/` | Регистрация пользователя |
| GET | `/api/users/{id}/` | Профиль пользователя |
| GET | `/api/users/me/` | Текущий пользователь |
| POST | `/api/users/{id}/subscribe/` | Подписаться на пользователя |
| DELETE | `/api/users/{id}/subscribe/` | Отписаться от пользователя |
| GET | `/api/users/subscriptions/` | Мои подписки |
| GET | `/api/ingredients/` | Список ингредиентов |
| GET | `/api/tags/` | Список тегов |

### Аутентификация
Проект использует Token-based аутентификацию:

```bash
# Получение токена
POST /api/auth/token/login/
{
    "email": "user@example.com",
    "password": "password"
}

# Использование токена в заголовках
Authorization: Token your-token-here
```

### Полная документация API
После запуска проекта документация доступна по адресу: http://localhost:3000/api/docs/

## Особенности реализации

### Загрузка изображений
- Изображения рецептов кодируются в base64 на frontend
- Backend декодирует и сохраняет как файлы через кастомное поле сериализатора

### Список покупок
- Ингредиенты автоматически суммируются при совпадении
- Файл генерируется в формате .txt с указанием количества и единиц измерения
- Формат: "Ингредиент (единица измерения) — количество"

### Поиск ингредиентов
- Поиск по названию без учёта регистра
- Поиск по вхождению в начало названия
- Автокомплит для удобства пользователей

### Пагинация
- Стандартный пагинатор DRF
- Настроена кастомная пагинация с полем `results`
- Возможность настройки количества записей на странице

### Администрирование

### Данные для входа по умолчанию
- **URL**: http://localhost:3000/admin/
- **Логин**: admin
- **Email**: admin@example.com  
- **Пароль**: admin

> **Важно**: Рекомендуется сменить пароль администратора после первого входа!

> **Примечание**: Администратор создается автоматически при запуске контейнера

### Админ-панель Django
Доступна по адресу: http://localhost:3000/admin/

### Возможности админ-панели:
- **Пользователи**: поиск по email и имени пользователя
- **Рецепты**: 
  - Отображение названия и автора в списке
  - Поиск по автору и названию
  - Счётчик добавлений в избранное
- **Ингредиенты**: 
  - Отображение названия и единиц измерения
  - Поиск по названию

## Тестирование

### Коллекция Postman
В директории `postman_collection/` находится готовая коллекция запросов для тестирования API.

Импортируйте коллекцию в Postman для отладки и проверки функциональности.

### Тестовые данные
- Администратор создается автоматически при запуске (admin/admin@example.com/admin)
- Ингредиенты загружаются автоматически из файлов в директории `data/`
- Для полного тестирования создайте дополнительных пользователей и рецепты через веб-интерфейс

### Полезные команды Just
```bash
# Просмотр всех доступных команд
just --list

# Сборка для разработки
just build

# Запуск продакшен версии
just run

# Остановка всех контейнеров
just down

# Очистка неиспользуемых volume
just prune
```

## Развёртывание в продакшене

### Подготовка сервера
1. Установите Docker и Docker Compose
2. Клонируйте репозиторий на сервер
3. Настройте переменные окружения в `.env`
4. Настройте доменное имя и SSL-сертификат

### Настройка CI/CD
Проект настроен для автоматического развёртывания через GitHub Actions.

Добавьте секреты в GitHub:
- `DOCKER_USERNAME` — имя пользователя Docker Hub
- `DOCKER_PASSWORD` — пароль Docker Hub
- `HOST` — IP адрес сервера
- `USER` — пользователь сервера
- `SSH_KEY` — приватный SSH ключ

## Контакты и поддержка

При возникновении вопросов или предложений по улучшению проекта, создавайте Issues в репозитории.

## Лицензия

Этот проект создан в учебных целях.